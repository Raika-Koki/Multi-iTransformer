Using device: cuda
[*********************100%***********************]  1 of 1 completed
Ticker            AAPL
Date
2012-05-18   15.978594
2012-05-21   16.909506
2012-05-22   16.779659
2012-05-23   17.189081
2012-05-24   17.031218
...                ...
2023-05-24  170.546951
2023-05-25  171.688324
2023-05-26  174.109955
2023-05-30  175.965881
2023-05-31  175.916245

[2776 rows x 1 columns]
/data/student/k2110261/Multi-iTransformer/optunademo.py:104: FutureWarning: Series.fillna with 'method' is deprecated and will raise in a future version. Use obj.ffill() or obj.bfill() instead.
  df = df.fillna(method='ffill')  # ÂâçÊó•„ÅÆ„Éá„Éº„Çø„Çí‰ΩøÁî®
{'AAPL': Date
2012-05-18     18.353260
2012-05-21     18.337501
2012-05-22     18.321753
2012-05-23     18.306016
2012-05-24     18.290290
                 ...
2023-05-24    161.245410
2023-05-25    161.302981
2023-05-26    161.360549
2023-05-30    161.418113
2023-05-31    161.475673
Name: trend, Length: 2776, dtype: float64, 'DTWEXBGS': Date
2012-05-18     93.1395
2012-05-21     93.0945
2012-05-22     93.1113
2012-05-23     93.8855
2012-05-24     93.8027
                ...
2023-05-24    120.6481
2023-05-25    121.0126
2023-05-26    120.8022
2023-05-30    120.7387
2023-05-31    121.1527
Length: 2776, dtype: float64, 'VIXCLS': Date
2012-05-18    25.10
2012-05-21    22.01
2012-05-22    22.48
2012-05-23    22.33
2012-05-24    21.54
              ...
2023-05-24    20.03
2023-05-25    19.14
2023-05-26    17.95
2023-05-30    17.46
2023-05-31    17.94
Length: 2776, dtype: float64, 'DFII10': Date
2012-05-18   -0.39
2012-05-21   -0.41
2012-05-22   -0.38
2012-05-23   -0.41
2012-05-24   -0.37
              ...
2023-05-24    1.48
2023-05-25    1.58
2023-05-26    1.57
2023-05-30    1.47
2023-05-31    1.46
Length: 2776, dtype: float64, 'T10Y2Y': Date
2012-05-18    1.39
2012-05-21    1.45
2012-05-22    1.49
2012-05-23    1.45
2012-05-24    1.48
              ...
2023-05-24   -0.58
2023-05-25   -0.67
2023-05-26   -0.74
2023-05-30   -0.77
2023-05-31   -0.76
Length: 2776, dtype: float64}
AAPL„Å´„ÅÇ„Çã„Åå‰ªñ„ÅÆ„Éá„Éº„Çø1„Å´„ÅØ„Å™„ÅÑÊó•‰ªò: DatetimeIndex([], dtype='datetime64[ns]', name='Date', freq=None)
‰ªñ„ÅÆ„Éá„Éº„Çø1„Å´„ÅÇ„Çã„ÅåAAPL„Å´„ÅØ„Å™„ÅÑÊó•‰ªò: DatetimeIndex([], dtype='datetime64[ns]', name='Date', freq=None)
Price      BB_Upper BB_Lower BB_Middle MACD MACD_Signal MACD_Diff RSI SMA_50 SMA_200
Ticker
Date
2012-05-18      NaN      NaN       NaN  NaN         NaN       NaN NaN    NaN     NaN
2012-05-21      NaN      NaN       NaN  NaN         NaN       NaN NaN    NaN     NaN
2012-05-22      NaN      NaN       NaN  NaN         NaN       NaN NaN    NaN     NaN
2012-05-23      NaN      NaN       NaN  NaN         NaN       NaN NaN    NaN     NaN
2012-05-24      NaN      NaN       NaN  NaN         NaN       NaN NaN    NaN     NaN
['AAPL', 'DTWEXBGS', 'VIXCLS', 'DFII10', 'T10Y2Y', 'BB_Upper', 'BB_Lower', 'BB_Middle', 'MACD', 'MACD_Signal', 'MACD_Diff', 'RSI', 'SMA_50', 'SMA_200']
dataframes_trend: dict_items([('AAPL', Date
2012-05-18     18.353260
2012-05-21     18.337501
2012-05-22     18.321753
2012-05-23     18.306016
2012-05-24     18.290290
                 ...
2023-05-24    161.245410
2023-05-25    161.302981
2023-05-26    161.360549
2023-05-30    161.418113
2023-05-31    161.475673
Name: trend, Length: 2776, dtype: float64), ('DTWEXBGS', Date
2012-05-18     93.1395
2012-05-21     93.0945
2012-05-22     93.1113
2012-05-23     93.8855
2012-05-24     93.8027
                ...
2023-05-24    120.6481
2023-05-25    121.0126
2023-05-26    120.8022
2023-05-30    120.7387
2023-05-31    121.1527
Length: 2776, dtype: float64), ('VIXCLS', Date
2012-05-18    25.10
2012-05-21    22.01
2012-05-22    22.48
2012-05-23    22.33
2012-05-24    21.54
              ...
2023-05-24    20.03
2023-05-25    19.14
2023-05-26    17.95
2023-05-30    17.46
2023-05-31    17.94
Length: 2776, dtype: float64), ('DFII10', Date
2012-05-18   -0.39
2012-05-21   -0.41
2012-05-22   -0.38
2012-05-23   -0.41
2012-05-24   -0.37
              ...
2023-05-24    1.48
2023-05-25    1.58
2023-05-26    1.57
2023-05-30    1.47
2023-05-31    1.46
Length: 2776, dtype: float64), ('T10Y2Y', Date
2012-05-18    1.39
2012-05-21    1.45
2012-05-22    1.49
2012-05-23    1.45
2012-05-24    1.48
              ...
2023-05-24   -0.58
2023-05-25   -0.67
2023-05-26   -0.74
2023-05-30   -0.77
2023-05-31   -0.76
Length: 2776, dtype: float64), ('BB_Upper', Date
2012-05-18           NaN
2012-05-21           NaN
2012-05-22           NaN
2012-05-23           NaN
2012-05-24           NaN
                 ...
2023-05-24    175.360190
2023-05-25    175.401880
2023-05-26    175.825121
2023-05-30    176.541931
2023-05-31    177.020398
Name: BB_Upper, Length: 2776, dtype: float64), ('BB_Lower', Date
2012-05-18           NaN
2012-05-21           NaN
2012-05-22           NaN
2012-05-23           NaN
2012-05-24           NaN
                 ...
2023-05-24    165.081600
2023-05-25    165.517552
2023-05-26    165.688247
2023-05-30    165.759885
2023-05-31    166.168969
Name: BB_Lower, Length: 2776, dtype: float64), ('BB_Middle', Date
2012-05-18           NaN
2012-05-21           NaN
2012-05-22           NaN
2012-05-23           NaN
2012-05-24           NaN
                 ...
2023-05-24    170.220895
2023-05-25    170.459716
2023-05-26    170.756684
2023-05-30    171.150908
2023-05-31    171.594683
Name: BB_Middle, Length: 2776, dtype: float64), ('MACD', Date
2012-05-18         NaN
2012-05-21         NaN
2012-05-22         NaN
2012-05-23         NaN
2012-05-24         NaN
                ...
2023-05-24    2.332940
2023-05-25    2.209844
2023-05-26    2.281397
2023-05-30    2.459509
2023-05-31    2.567067
Name: MACD, Length: 2776, dtype: float64), ('MACD_Signal', Date
2012-05-18         NaN
2012-05-21         NaN
2012-05-22         NaN
2012-05-23         NaN
2012-05-24         NaN
                ...
2023-05-24    2.724339
2023-05-25    2.621440
2023-05-26    2.553431
2023-05-30    2.534647
2023-05-31    2.541131
Name: MACD_Signal, Length: 2776, dtype: float64), ('MACD_Diff', Date
2012-05-18         NaN
2012-05-21         NaN
2012-05-22         NaN
2012-05-23         NaN
2012-05-24         NaN
                ...
2023-05-24   -0.391399
2023-05-25   -0.411596
2023-05-26   -0.272034
2023-05-30   -0.075138
2023-05-31    0.025936
Name: MACD_Diff, Length: 2776, dtype: float64), ('RSI', Date
2012-05-18          NaN
2012-05-21          NaN
2012-05-22          NaN
2012-05-23          NaN
2012-05-24          NaN
                ...
2023-05-24    55.867171
2023-05-25    58.637842
2023-05-26    63.826750
2023-05-30    67.220732
2023-05-31    67.039565
Name: RSI, Length: 2776, dtype: float64), ('SMA_50', Date
2012-05-18           NaN
2012-05-21           NaN
2012-05-22           NaN
2012-05-23           NaN
2012-05-24           NaN
                 ...
2023-05-24    164.409243
2023-05-25    164.810428
2023-05-26    165.203354
2023-05-30    165.650248
2023-05-31    166.048576
Name: SMA_50, Length: 2776, dtype: float64), ('SMA_200', Date
2012-05-18           NaN
2012-05-21           NaN
2012-05-22           NaN
2012-05-23           NaN
2012-05-24           NaN
                 ...
2023-05-24    150.685263
2023-05-25    150.729037
2023-05-26    150.763580
2023-05-30    150.811107
2023-05-31    150.840553
Name: SMA_200, Length: 2776, dtype: float64)])
dataframes_trend: dict_items([('AAPL', Date
2013-03-07     15.555098
2013-03-08     15.542718
2013-03-11     15.530341
2013-03-12     15.517967
2013-03-13     15.505595
                 ...
2023-05-24    161.245410
2023-05-25    161.302981
2023-05-26    161.360549
2023-05-30    161.418113
2023-05-31    161.475673
Name: trend, Length: 2577, dtype: float64), ('DTWEXBGS', Date
2013-03-07     92.5462
2013-03-08     92.6252
2013-03-11     92.5351
2013-03-12     92.3853
2013-03-13     92.4709
                ...
2023-05-24    120.6481
2023-05-25    121.0126
2023-05-26    120.8022
2023-05-30    120.7387
2023-05-31    121.1527
Length: 2577, dtype: float64), ('VIXCLS', Date
2013-03-07    13.06
2013-03-08    12.59
2013-03-11    11.56
2013-03-12    12.27
2013-03-13    11.83
              ...
2023-05-24    20.03
2023-05-25    19.14
2023-05-26    17.95
2023-05-30    17.46
2023-05-31    17.94
Length: 2577, dtype: float64), ('DFII10', Date
2013-03-07   -0.56
2013-03-08   -0.50
2013-03-11   -0.50
2013-03-12   -0.52
2013-03-13   -0.52
              ...
2023-05-24    1.48
2023-05-25    1.58
2023-05-26    1.57
2023-05-30    1.47
2023-05-31    1.46
Length: 2577, dtype: float64), ('T10Y2Y', Date
2013-03-07    1.75
2013-03-08    1.79
2013-03-11    1.80
2013-03-12    1.76
2013-03-13    1.77
              ...
2023-05-24   -0.58
2023-05-25   -0.67
2023-05-26   -0.74
2023-05-30   -0.77
2023-05-31   -0.76
Length: 2577, dtype: float64), ('BB_Upper', Date
2013-03-07     14.800106
2013-03-08     14.740508
2013-03-11     14.622188
2013-03-12     14.451165
2013-03-13     14.346887
                 ...
2023-05-24    175.360190
2023-05-25    175.401880
2023-05-26    175.825121
2023-05-30    176.541931
2023-05-31    177.020398
Name: BB_Upper, Length: 2577, dtype: float64), ('BB_Lower', Date
2013-03-07     12.732896
2013-03-08     12.680908
2013-03-11     12.685778
2013-03-12     12.699358
2013-03-13     12.682725
                 ...
2023-05-24    165.081600
2023-05-25    165.517552
2023-05-26    165.688247
2023-05-30    165.759885
2023-05-31    166.168969
Name: BB_Lower, Length: 2577, dtype: float64), ('BB_Middle', Date
2013-03-07     13.766501
2013-03-08     13.710708
2013-03-11     13.653983
2013-03-12     13.575261
2013-03-13     13.514806
                 ...
2023-05-24    170.220895
2023-05-25    170.459716
2023-05-26    170.756684
2023-05-30    171.150908
2023-05-31    171.594683
Name: BB_Middle, Length: 2577, dtype: float64), ('MACD', Date
2013-03-07   -0.411427
2013-03-08   -0.396536
2013-03-11   -0.365352
2013-03-12   -0.359779
2013-03-13   -0.351507
                ...
2023-05-24    2.332940
2023-05-25    2.209844
2023-05-26    2.281397
2023-05-30    2.459509
2023-05-31    2.567067
Name: MACD, Length: 2577, dtype: float64), ('MACD_Signal', Date
2013-03-07   -0.389184
2013-03-08   -0.390654
2013-03-11   -0.385594
2013-03-12   -0.380431
2013-03-13   -0.374646
                ...
2023-05-24    2.724339
2023-05-25    2.621440
2023-05-26    2.553431
2023-05-30    2.534647
2023-05-31    2.541131
Name: MACD_Signal, Length: 2577, dtype: float64), ('MACD_Diff', Date
2013-03-07   -0.022244
2013-03-08   -0.005882
2013-03-11    0.020241
2013-03-12    0.020652
2013-03-13    0.023139
                ...
2023-05-24   -0.391399
2023-05-25   -0.411596
2023-05-26   -0.272034
2023-05-30   -0.075138
2023-05-31    0.025936
Name: MACD_Diff, Length: 2577, dtype: float64), ('RSI', Date
2013-03-07    38.423497
2013-03-08    39.155765
2013-03-11    43.087594
2013-03-12    38.929082
2013-03-13    38.894870
                ...
2023-05-24    55.867171
2023-05-25    58.637842
2023-05-26    63.826750
2023-05-30    67.220732
2023-05-31    67.039565
Name: RSI, Length: 2577, dtype: float64), ('SMA_50', Date
2013-03-07     14.536962
2013-03-08     14.484724
2013-03-11     14.440605
2013-03-12     14.389462
2013-03-13     14.341595
                 ...
2023-05-24    164.409243
2023-05-25    164.810428
2023-05-26    165.203354
2023-05-30    165.650248
2023-05-31    166.048576
Name: SMA_50, Length: 2577, dtype: float64), ('SMA_200', Date
2013-03-07     17.349991
2013-03-08     17.336090
2013-03-11     17.318474
2013-03-12     17.300064
2013-03-13     17.279595
                 ...
2023-05-24    150.685263
2023-05-25    150.729037
2023-05-26    150.763580
2023-05-30    150.811107
2023-05-31    150.840553
Name: SMA_200, Length: 2577, dtype: float64)])
AAPL null values:
0
DTWEXBGS null values:
0
VIXCLS null values:
0
DFII10 null values:
0
T10Y2Y null values:
0
BB_Upper null values:
0
BB_Lower null values:
0
BB_Middle null values:
0
MACD null values:
0
MACD_Signal null values:
0
MACD_Diff null values:
0
RSI null values:
0
SMA_50 null values:
0
SMA_200 null values:
0
[32m[I 2024-11-17 17:30:50,932][0m A new study created in memory with name: no-name-d311671d-56cb-4d43-af0e-a3456d4836ef[0m
Non-A100 GPU detected, using math or mem efficient attention if input tensor is on cuda
/home2/y2021/k2110261/.conda/envs/tensorflow/lib/python3.11/contextlib.py:105: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
[32m[I 2024-11-17 17:30:53,548][0m Trial 0 finished with value: 4.204334450044227 and parameters: {'observation_period_num': 33, 'train_rates': 0.7965650579147978, 'learning_rate': 1.5178511514374182e-05, 'batch_size': 201, 'step_size': 10, 'gamma': 0.8026596401256079, 'depth': 5, 'dim': 225}. Best is trial 0 with value: 4.204334450044227.[0m
[32m[I 2024-11-17 17:30:53,549][0m A new study created in memory with name: no-name-4604916d-bf6d-4fed-acb3-bde275d6a526[0m
[32m[I 2024-11-17 17:30:54,533][0m Trial 0 finished with value: 1.0671357824080112 and parameters: {'observation_period_num': 133, 'train_rates': 0.6946607405241728, 'learning_rate': 6.552373240840064e-05, 'batch_size': 56, 'step_size': 1, 'gamma': 0.9216160451425718, 'depth': 3, 'dim': 126}. Best is trial 0 with value: 1.0671357824080112.[0m
[32m[I 2024-11-17 17:30:54,533][0m A new study created in memory with name: no-name-1781c209-84bc-4567-b284-e81220b1633c[0m
[32m[I 2024-11-17 17:30:55,286][0m Trial 0 finished with value: 1.0275295582199355 and parameters: {'observation_period_num': 222, 'train_rates': 0.6871422679936725, 'learning_rate': 0.00031010882501839563, 'batch_size': 145, 'step_size': 3, 'gamma': 0.9519913085931165, 'depth': 3, 'dim': 116}. Best is trial 0 with value: 1.0275295582199355.[0m
Best hyperparameters (trend): {'observation_period_num': 33, 'train_rates': 0.7965650579147978, 'learning_rate': 1.5178511514374182e-05, 'batch_size': 201, 'step_size': 10, 'gamma': 0.8026596401256079, 'depth': 5, 'dim': 225}
Best hyperparameters (seasonal): {'observation_period_num': 133, 'train_rates': 0.6946607405241728, 'learning_rate': 6.552373240840064e-05, 'batch_size': 56, 'step_size': 1, 'gamma': 0.9216160451425718, 'depth': 3, 'dim': 126}
Best hyperparameters (resid): {'observation_period_num': 222, 'train_rates': 0.6871422679936725, 'learning_rate': 0.00031010882501839563, 'batch_size': 145, 'step_size': 3, 'gamma': 0.9519913085931165, 'depth': 3, 'dim': 116}
Epoch 1/1000, (Training | Validation) Trend Loss: 0.4677 | 1.4077, Seasonal Loss: 0.2561 | 1.1913, Residual Loss: 0.5233 | 1.4164
Epoch 2/1000, (Training | Validation) Trend Loss: 0.2556 | 0.9120, Seasonal Loss: 0.2101 | 0.9867, Residual Loss: 0.2922 | 1.1232
Epoch 3/1000, (Training | Validation) Trend Loss: 0.2108 | 0.7739, Seasonal Loss: 0.1764 | 0.9081, Residual Loss: 0.2236 | 0.9258
Epoch 4/1000, (Training | Validation) Trend Loss: 0.1765 | 0.7600, Seasonal Loss: 0.1627 | 0.8612, Residual Loss: 0.1596 | 0.9609
Epoch 5/1000, (Training | Validation) Trend Loss: 0.1590 | 0.7073, Seasonal Loss: 0.1546 | 0.8228, Residual Loss: 0.1543 | 0.8320
Epoch 6/1000, (Training | Validation) Trend Loss: 0.1464 | 0.6164, Seasonal Loss: 0.1484 | 0.7877, Residual Loss: 0.1358 | 0.8045
Epoch 7/1000, (Training | Validation) Trend Loss: 0.1371 | 0.5679, Seasonal Loss: 0.1426 | 0.7545, Residual Loss: 0.1251 | 0.7872
Epoch 8/1000, (Training | Validation) Trend Loss: 0.1298 | 0.5398, Seasonal Loss: 0.1357 | 0.7238, Residual Loss: 0.1206 | 0.7664
Epoch 9/1000, (Training | Validation) Trend Loss: 0.1240 | 0.5066, Seasonal Loss: 0.1277 | 0.6972, Residual Loss: 0.1079 | 0.7436
Epoch 10/1000, (Training | Validation) Trend Loss: 0.1191 | 0.4797, Seasonal Loss: 0.1199 | 0.6752, Residual Loss: 0.1002 | 0.7331
Epoch 11/1000, (Training | Validation) Trend Loss: 0.1148 | 0.4633, Seasonal Loss: 0.1132 | 0.6571, Residual Loss: 0.0922 | 0.7341
Epoch 12/1000, (Training | Validation) Trend Loss: 0.1115 | 0.4481, Seasonal Loss: 0.1078 | 0.6422, Residual Loss: 0.0875 | 0.7261
Epoch 13/1000, (Training | Validation) Trend Loss: 0.1084 | 0.4345, Seasonal Loss: 0.1033 | 0.6297, Residual Loss: 0.0817 | 0.7339
Epoch 14/1000, (Training | Validation) Trend Loss: 0.1054 | 0.4217, Seasonal Loss: 0.0995 | 0.6190, Residual Loss: 0.0748 | 0.7065
Epoch 15/1000, (Training | Validation) Trend Loss: 0.1027 | 0.4095, Seasonal Loss: 0.0963 | 0.6099, Residual Loss: 0.0662 | 0.7105
Epoch 16/1000, (Training | Validation) Trend Loss: 0.1000 | 0.3982, Seasonal Loss: 0.0934 | 0.6019, Residual Loss: 0.0588 | 0.6904
Epoch 17/1000, (Training | Validation) Trend Loss: 0.0975 | 0.3873, Seasonal Loss: 0.0909 | 0.5949, Residual Loss: 0.0543 | 0.6847
Epoch 18/1000, (Training | Validation) Trend Loss: 0.0952 | 0.3771, Seasonal Loss: 0.0887 | 0.5886, Residual Loss: 0.0543 | 0.6684
Epoch 19/1000, (Training | Validation) Trend Loss: 0.0929 | 0.3673, Seasonal Loss: 0.0868 | 0.5831, Residual Loss: 0.0584 | 0.7167
Epoch 20/1000, (Training | Validation) Trend Loss: 0.0907 | 0.3581, Seasonal Loss: 0.0850 | 0.5781, Residual Loss: 0.0577 | 0.6097
Epoch 21/1000, (Training | Validation) Trend Loss: 0.0887 | 0.3507, Seasonal Loss: 0.0835 | 0.5737, Residual Loss: 0.0514 | 0.7540
Epoch 22/1000, (Training | Validation) Trend Loss: 0.0871 | 0.3433, Seasonal Loss: 0.0821 | 0.5696, Residual Loss: 0.0492 | 0.6178
Epoch 23/1000, (Training | Validation) Trend Loss: 0.0855 | 0.3372, Seasonal Loss: 0.0808 | 0.5660, Residual Loss: 0.0477 | 0.7764
Epoch 24/1000, (Training | Validation) Trend Loss: 0.0840 | 0.3308, Seasonal Loss: 0.0797 | 0.5626, Residual Loss: 0.0474 | 0.7087
Epoch 25/1000, (Training | Validation) Trend Loss: 0.0825 | 0.3244, Seasonal Loss: 0.0787 | 0.5596, Residual Loss: 0.0497 | 0.7904
Epoch 26/1000, (Training | Validation) Trend Loss: 0.0811 | 0.3185, Seasonal Loss: 0.0777 | 0.5569, Residual Loss: 0.0506 | 0.7552
Epoch 27/1000, (Training | Validation) Trend Loss: 0.0797 | 0.3126, Seasonal Loss: 0.0769 | 0.5543, Residual Loss: 0.0533 | 0.6390
Traceback (most recent call last):
  File "/data/student/k2110261/Multi-iTransformer/optunademo.py", line 341, in <module>
    model_trend, train_loss_trend, valid_loss_trend = train(
                                                      ^^^^^^
  File "/data/student/k2110261/Multi-iTransformer/src/train.py", line 43, in train
    total_loss_train += loss.item() * data.size(0)
                        ^^^^^^^^^^^
KeyboardInterrupt
